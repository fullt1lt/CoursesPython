# Лекция 23. Шаблоны (Templates) в Django

![](image/template_django.png)

## Что мы сегодня будем учить?

![](image/MVT_Template.png)

## Введение в Django Templates

Когда мы создаём веб-приложение, одна из главных задач — показать пользователю красивую `HTML`-страницу. Но что делать, если на этой странице должен быть не просто текст, а динамические данные? Например, список товаров, имя пользователя или дата?

Писать `HTML` вручную для каждого случая — очень неудобно и абсолютно непрактично. Здесь нам и приходят на помощь шаблоны (`templates`).

## Что такое шаблоны и зачем они нужны?

**Шаблон** — это обычный `HTML`-файл, в который можно добавить специальный синтаксис `Django`, чтобы вставлять динамические данные прямо в код страницы. Такой подход позволяет сделать `HTML` *«живым»* — он будет меняться в зависимости от ситуации и переданных данных.

Шаблоны позволяют Django:

- Подставлять переменные прямо в `HTML` — например, имя пользователя, список товаров, дату и т.д.
- Разделять логику и отображение — логика остаётся во `view`-функциях, а шаблон отвечает только за внешний вид.
- Переиспользовать один и тот же `HTML`-шаблон с разными данными — это экономит время и упрощает поддержку кода.

Именно шаблоны позволяют нам генерировать динамические страницы без копипаста и лишнего кода. Это один из ключевых инструментов при работе с `Django`.

## Как работает Django с шаблонами?

![](image/python_info_templates.png)

Чтобы понять, как `Django` формирует `HTML`-страницы, представим путь, который проходит каждый запрос пользователя. Это как цепочка действий, где каждая часть отвечает за свою задачу.

На картинке выше изображена архитектура `Django` — `Model–View–Template` (`MVT`).

- Пользователь открывает сайт — и отправляет запрос.
- Этот запрос попадает в Django и сначала проверяется маршрутизатором (URLconf).
- Найдя нужный путь, Django передаёт управление в `View` — это та часть, где мы описываем логику: какие данные получить, как обработать запрос, что вернуть.
- `View` при необходимости обращается к `Model` — это работа с базой данных. Она может что-то запросить, изменить или сохранить.(Пока нас этот блок не интересует)
- Получив нужные данные, `View` подставляет их в шаблон (`Template`).
- `Template` превращается в готовый HTML-код, в котором уже есть данные — например, список товаров, имя пользователя и т.п.
- `Django` возвращает этот `HTML` в браузер, и пользователь видит уже отрисованную страницу.

Таким образом, шаблоны — это конечный этап обработки запроса, который отвечает за красивую подачу данных. Всё, что увидит пользователь — будет результатом работы шаблона.

## Где Django ищет шаблоны?

Когда вы работаете с `HTML`-шаблонами в `Django`, их нужно хранить в специальных папках, чтобы `Django` мог их находить и использовать.

Есть два основных способа хранения шаблонов:

### 1. Внутри приложения (локально)
Каждое приложение в Django может содержать свою папку templates. Это удобно, потому что все шаблоны, относящиеся к этому приложению, будут лежать рядом с ним.

Пример структуры:

```plaintext
my_app/
├── views.py
├── models.py
├── ...
└── templates/
    └── my_app/
        └── hello.html
```

Обрати внимание: внутри `templates/` мы создаём папку с тем же именем, что и приложение — `my_app`. Это не обязательно, но очень рекомендуется, чтобы избежать конфликтов, если в проекте будет много приложений с шаблонами.

### 2. В корневой папке проекта (глобально)

Также можно создать общую папку `templates/` на уровне проекта. Она обычно используется для общих шаблонов — например, главной страницы, страницы ошибки, или позже — базовых шаблонов.

Пример структуры:

```plaintext
my_django_project/
├── my_project/
│   └── settings.py
├── my_app/
│   └── templates/
│       └── my_app/
│           └── hello.html
├── templates/
│   └── some_global_template.html
└── manage.py
```

Чтобы `Django` нашёл шаблоны из этой папки, её нужно указать в `settings.py`. В настройках `TEMPLATES` есть параметр `DIRS`. Туда можно добавить путь до папки `templates`:

```python
TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": ['templates'], #<- глобальная папка с шаблонами
        "APP_DIRS": True,
        "OPTIONS": {
            "context_processors": [
                "django.template.context_processors.debug",
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
            ],
        },
    },
]
```

Если `APP_DIRS`: `True` — `Django` также будет искать шаблоны внутри каждого приложения `(в my_app/templates/...)`.

### Как выбрать, куда положить шаблон?

- Если шаблон используется только внутри одного приложения, лучше положить его внутрь приложения.
- Если шаблон используется всем проектом (например, общая шапка сайта или главная страница), можно положить его в глобальную папку `templates/`.

Мы пока будем сохранять все наши шаблоны в глобальную папку `templates/`.

## Простой пример

### 1. Создаём папку templates на уровне проекта

На одном уровне с `manage.py`, создим папку `templates/`, а в ней файл `index.html`.

```plaintext
my_project/
├── my_app/
│   └── views.py
├── my_project/
│   ├── settings.py
│   └── urls.py
│
├── templates/
│   └── index.html   ← Шаблон лежит здесь!
│
└── manage.py
```

### 2. Содержимое index.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello</title>
</head>
<body>
    <h1>Hello, World!</h1>
</body>
</html>
```

### 3. Обновляем views.py

В файле `myapp/views.py` нужно импортировать обработчик шаблонов, в начало файла добавляем

```python
from django.shortcuts import render
```

**render()** — это встроенная функция Django, которая:

- Принимает HTTP-запрос от пользователя.
- Находит нужный шаблон (HTML-файл).
- Подставляет туда данные (если они есть).
- Возвращает готовый HTML-ответ обратно клиенту.

Нам для начала нужно понимать, что в `render()` нужно передать (`request` — запрос от браузера и вторым параметром `index.html`(**это может быть любой другой шаблон**) в директориях шаблонов (`templates/`, или внутри приложения))

Теперь пусть `hello()` рендерит глобальный шаблон `index.html`:

```python
from django.shortcuts import render

def hello(request):
    return render(request, "index.html")
```

### 4. URL — всё как раньше

В URL после первой лекции можем оставить путь без изменений.

```python
# файл urls.py в папке приложения my_app

from my_app.views import hello, home, hello_fixed, hello_dynamic, hello_id, hello_slug
from django.urls import path

urlpatterns = [
    path("", home),
    path("hello/", hello), # <- оставляем без изменения
    path("hello/fixed", hello_fixed, name="hello_fixed"),
    path("hello/<str:name>/", hello_dynamic, name="hello_name"),
    path("hello/id/<int:user_id>/", hello_id, name="hello_by_id"),
    path("hello/slug/<slug:slug>/", hello_slug, name="hello_by_slug"),
]
```

Теперь при заходе на `http://127.0.0.1:8000/hello/` ты увидишь страницу, сгенерированную из `index.html`, который находится в глобальной папке `templates`.

## Как передать переменные в шаблон?

Только что мы научились выводить статический шаблон для пользователя. У нас есть обычный `HTML`-файл, и `view` просто говорит `Django`: "Отправь этот шаблон пользователю".

```python
def hello(request):
    return render(request, "index.html")
```

Этот пример хорош для понимания, как `Django` ищет и отображает шаблоны. Но, если задуматься: а как нам сделать страницу динамической? Как подставить туда имя пользователя, его возраст или любую другую информацию?

Для этого `Django`-шаблоны умеют принимать данные из `view`-функции. Мы можем передать так называемый `context` — это словарь, в котором ключи становятся переменными в шаблоне.

### Представим следующую ситуацию:

У нас есть пользователь, его зовут `Иван`, и ему `25` лет. Мы хотим, чтобы шаблон приветствовал его по имени и сообщал его возраст.

Для этого мы немного изменим нашу функцию `hello` и передадим в неё `context`:

```python
def hello(request):
    context = {
        "name": "Иван",
        "age": 25
    }
    return render(request, "index.html", context)
```

Значения переданы, но пока они никак не используются, давайте же посмотрим, как отобразить переменные в шаблоне!

Когда мы вызываем `render(request, "index.html", context)`, мы передаём в шаблон третьим аргументом словарь `context`, в котором хранятся данные. Это как посылка: мы кладём в неё нужные переменные, и `Django` приносит их в шаблон.

Теперь внутри `index.html` мы можем использовать эту переменную, чтобы вывести её прямо в `HTML`:

```html
<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Приветствие</title>
</head>
<body>
    <h1>Привет, {{ name }}!</h1>
    <p>Тебе {{ age }} лет.</p>
</body>
</html>
```

Конструкция `{{ ... }}` — это синтаксис шаблонного языка `Django`. Всё, что мы передали из `views.py`, можно отобразить с помощью таких двойных фигурных скобок.

**Теперь мы увидим:**

![](image/template_with_variable.png)

### А если переменной нет?
Если в `context` не было переменной `name`, то `Django` просто ничего не выведет на месте `{{ name }}`. Это безопасно — ошибки не будет, но и данных не будет.

## Пример: передаём разные типы данных в шаблон
В реальных проектах мы часто передаём в шаблон не только строки и числа, но и списки, словари, множества, кортежи. Это необходимо, если вы хотите отобразить таблицу, список товаров, блок новостей или любые другие данные.

**Давайте создадим пример представления:**

```python
from django.shortcuts import render

def hello(request):
    my_num = 42  # Число
    my_str = 'Это просто строка'  # Строка
    my_dict = {"ключ1": "значение1", "ключ2": "значение2"}  # Словарь
    my_list = ['первый элемент', 'второй элемент', 'третий элемент']  # Список
    my_set = {'элемент множества 1', 'элемент множества 2'}  # Множество
    my_tuple = ('первый', 'второй', 'третий')  # Кортеж

    return render(request, 'index.html', {
        'my_num': my_num,
        'my_str': my_str,
        'my_dict': my_dict,
        'my_list': my_list,
        'my_set': my_set,
        'my_tuple': my_tuple,
    })
```

Файл `index.html`

```html
<!DOCTYPE html>
<html>
<head>
    <title>Передача данных в шаблон</title>
</head>
<body>
    <h1>Простые типы</h1>
    <p style="border: 2px solid blue; padding: 5px;">Число: {{ my_num }}</p>
    <p style="border: 2px solid green; padding: 5px;">Строка: {{ my_str }}</p>

    <h1>Коллекции</h1>
    <p style="border: 2px solid red; padding: 5px;">Словарь: {{ my_dict }}</p>
    <p style="border: 2px solid orange; padding: 5px;">Список: {{ my_list }}</p>
    <p style="border: 2px solid purple; padding: 5px;">Множество: {{ my_set }}</p>
    <p style="border: 2px solid pink; padding: 5px;">Кортеж: {{ my_tuple }}</p>
</body>
</html>
```

Все данные, переданные в `context` (в виде словаря), можно вывести в шаблоне через `{{ имя_переменной }}`.

![](image/template_with_all_variable.png)

## Логические операторы и циклы

![](https://www.meme-arsenal.com/memes/3e7378f57a48d60587692d91e923c90b.jpg)

В прошлом примере мы научились передавать данные в шаблон и выводить их в `HTML` как есть — с помощью простого синтаксиса `{{ переменная }}`. Но часто нам нужно не просто отобразить данные, а обрабатывать их в шаблоне: проверять условия или проходиться по коллекциям (спискам, словарям и т.д.).

В `Django`-шаблонах для этого есть логические конструкции. Самые распространённые из них — это:

- `{% if %}` — условный оператор
- `{% for %}` — цикл по элементам

### Цикл for в шаблонах

Когда у нас есть список, множество, кортеж или словарь, и мы хотим пройтись по его элементам, мы используем конструкцию `{% for item in collection %}`.

Допустим, в наш шаблон передали список:

```python
def hello(request):
    my_list = ['первый элемент', 'второй элемент', 'третий элемент']

    return render(request, 'index.html', {
        'my_list': my_list,
    })
```

И мы хотим отобразить каждый элемент этого списка отдельно — пишем в шаблоне:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Передача данных в шаблон</title>
    <style>
      .Block_List {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
      }
      .My_list {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
        padding: 0;
      }
      .List_item {
        width: 300px;
        list-style: none;
        padding: 5px;
        margin-top: 10px;
        border: 2px solid red;
      }
    </style>
  </head>
  <body>
    <div class="Block_List">
      <h2>Список</h2>
      <ul class="My_list">
        {% for item in my_list %}
        <li class="List_item">{{ item }}</li>
        {% endfor %}
      </ul>
    </div>
  </body>
</html>

```

![](image/template_for.png)

Важно: `for` обязательно закрывается `endfor`. Это похоже на обычный `Python`, но синтаксис без `:` и без отступов.

### Условные конструкции if

А теперь представим, что мы хотим показать блок только при определённом условии.

Например, только если пользователь — админ:

```python
is_admin = True
```

В шаблоне пишем:

```html
{% if is_admin %}
  <p>Добро пожаловать, администратор!</p>
{% else %}
  <p>Привет, пользователь!</p>
{% endif %}
```

![](image/template_if.png)

Можно использовать и `elif`:

```html
{% if age < 18 %}
  <p>Ты ещё слишком юн.</p>
{% elif age < 60 %}
  <p>Здравствуй, взрослый человек.</p>
{% else %}
  <p>Вы мудры и опытны.</p>
{% endif %}
```

Обратите вснимание что `if` также нужно закрывать `endif`.

### А теперь — реальный пример

Дополним наш предыдущий шаблон `index.html`, где уже передавали данные, и добавим туда цикл `for` и условие `if`.

Представим, что во `view` у нас такой код:

```python
def hello(request):
    names = ['Иван', 'Мария', 'Алексей']
    is_logged_in = True
    user_age = 25

    return render(request, 'index.html', {
        'names': names,
        'is_logged_in': is_logged_in,
        'user_age': user_age,
    })
```

И вот такой шаблон:

```html
<h1>Добро пожаловать!</h1>

{% if is_logged_in %}
  <p style="color: green;">Вы вошли в систему.</p>
{% else %}
  <p style="color: red;">Пожалуйста, авторизуйтесь.</p>
{% endif %}

{% if user_age < 18 %}
  <p>Вам нет 18 лет.</p>
{% elif user_age < 60 %}
  <p>Вы взрослый пользователь.</p>
{% else %}
  <p>Вы пожилой пользователь.</p>
{% endif %}

<h2>Список пользователей:</h2>
<ul>
  {% for name in names %}
    <li>{{ name }}</li>
  {% endfor %}
</ul>
```

![](image/template_real.png)