# Лекция 17. СУБД. PostgreSQL. SQL. DDL. Пользователи. DCL. DML. Связи. 

![spiderMan.png](image/spiderMan.png)

## Введение в СУБД

**Системы управления базами данных (СУБД)** – это программные системы, предназначенные для создания, хранения, управления и обработки данных. Они обеспечивают доступ к информации, хранящейся в структурированном виде, и позволяют пользователям выполнять различные операции с данными.

## Почему важны СУБД?

СУБД широко применяются в самых разных сферах: бизнесе, медицине, финансах, образовании, государственных учреждениях и многих других отраслях. Они обеспечивают хранение и обработку больших объемов информации, что делает их важным элементом информационных систем.

## Типы СУБД

![Type_db.png](image/Type_db.png)

Существует несколько основных типов СУБД:

 - **Реляционные (SQL)** – используют таблицы для организации данных и поддерживают язык SQL для их обработки. Примеры: PostgreSQL, MySQL, Oracle, MS SQL Server.
 - **NoSQL** – предназначены для работы с неструктурированными и слабо структурированными данными. Примеры: MongoDB (документо-ориентированная), Redis (ключ-значение), Neo4j (графовая), Cassandra (колонно-ориентированная).
 - **Объектно-ориентированные** – совмещают возможности реляционных баз данных и объектно-ориентированного программирования. Примеры: db4o, Versant.
- **Гибридные** – сочетают возможности SQL и NoSQL для повышения гибкости работы с данными. Пример: PostgreSQL с поддержкой JSONB.

## PostgreSQL

![PostgreSQL.png](image/PostgreSQL.png)

### Что такое PostgreSQL?

**PostgreSQL** – это мощная объектно-реляционная СУБД с открытым исходным кодом. Она известна своей надежностью, поддержкой стандарта SQL и широкими возможностями расширения. PostgreSQL используется во многих крупных проектах благодаря своей гибкости и высокой производительности.

**Преимущества PostgreSQL:**

- Поддержка ACID-транзакций.
- Расширяемость (возможность добавлять собственные функции, операторы и типы данных).
- Полная поддержка SQL, включая оконные функции и подзапросы.
- Возможность хранения структурированных и неструктурированных данных (JSON, JSONB).
- Гибкая система управления доступом.
- Репликация и масштабируемость.

## Что такое база данных?

**База данных (БД)** – это организованный набор данных, который управляется с помощью СУБД. В современных системах баз данных используются различные модели представления данных, однако наиболее распространённой является реляционная модель.

### Взаимодействие баз данных и пользователей в PostgreSQL

В одной СУБД можно создать бесконечно много баз данных. Это позволяет изолировать данные различных проектов и эффективно управлять ими. Кроме того, внутри одной СУБД можно создавать пользователей и назначать им различные права доступа. Это позволяет контролировать, какие действия могут выполнять разные пользователи.

#### Почему это важно?

Когда мы работаем над реальным проектом, под него создаётся отдельная база данных. Это позволяет: 

- Изолировать данные проекта от других баз, которые могут находиться в той же СУБД.
- Разграничить доступ – например, один пользователь может только просматривать данные, другой – изменять, а третий – администрировать базу.
- Обеспечить безопасность, исключив возможность случайного удаления или модификации чужих данных.

## Таблицы: строки и столбцы

Что такое таблицы в базе данных?

**Таблица** – это основная структура хранения данных в реляционной базе данных. Она представляет собой двухмерную структуру, состоящую из строк и столбцов.

### Строки в таблице

Строка (или запись) в таблице представляет собой один объект, содержащий определённые данные. Например, если таблица хранит информацию о пользователях, каждая строка будет представлять одного пользователя с уникальными характеристиками.

Пример базы данных в виде таблицы `Пользователи`:

| id  | имя      | email               | возраст |
|-----|---------|--------------------|--------|
| 1   | Иван    | ivan@example.com   | 25     |
| 2   | Мария   | maria@example.com  | 30     |
| 3   | Алексей | alex@example.com   | 28     |

Каждая строка содержит информацию о конкретном пользователе.

### Столбцы в таблице

**Столбец** – это характеристика (атрибут) объекта. Он определяет тип информации, которая хранится в таблице. Например, в таблице Пользователи есть столбцы `id`, `имя`, `email` и `возраст`, которые описывают разные свойства пользователя.

На cтолбцы могут накладываться ограничения. Например, какое-то поле не может быть пустым, или какое-то поле не может быть меньше определенного значения, например возраст не может быть отрицательным.

**Основные свойства столбцов:**

- Имя столбца – определяет, какую информацию он хранит (например, имя для имени пользователя, `email` для электронной почты).
- Тип данных – указывает, какие значения могут храниться в этом столбце (например, возраст – это число, а `email` – строка).
- Ограничения – правила, которые применяются к данным (например, `email` должен быть уникальным, а `id` – автоувеличивающимся).

### Как связаны строки и столбцы?

Каждая строка в таблице содержит значения во всех столбцах. Например, в таблице Пользователи, строка с `id = 1 `хранит:

- В столбце `имя` – `"Иван"`
- В столбце `email` – `"ivan@example.com"`
- В столбце `возраст` – `25`

Это даёт возможность быстро находить, изменять и удалять информацию в базе данных, ориентируясь на значения в столбцах.

## Типы данных в БД

Тип данных определяет, какие значения могут храниться в определённом столбце таблицы. В PostgreSQL используются следующие основные типы данных:

### 1. Строковые типы

- `CHAR(n)` – строка фиксированной длины (например, CHAR(10) хранит ровно 10 символов).
- `VARCHAR(n)` – строка переменной длины, ограниченная n символами.
- `TEXT` – строка произвольной длины без ограничения.

**Применение:** используется для хранения имен, адресов, описаний и других текстовых данных.

### 2. Числовые типы

- `INTEGER (INT)` – целочисленный тип, подходящий для хранения небольших чисел (например, идентификаторов).
- `BIGINT` – используется для больших чисел (например, длинных ID в системах с миллионами записей).
- `DECIMAL (NUMERIC)` – число с фиксированной точностью, часто применяется для денежных значений.
- `REAL, DOUBLE PRECISION` – числа с плавающей запятой для научных вычислений.

**Применение:** возраст, количество, финансовые показатели.

### 3. Булевый тип

- `BOOLEAN` – принимает только два значения: `TRUE` или `FALSE`.

**Применение:** статус включено/выключено, истина/ложь, да/нет.

### 4. Дата и время

- `DATE` – хранит дату (год, месяц, день).
- `TIME` – хранит время (часы, минуты, секунды).
- `TIMESTAMP` – хранит дату и время.
- `INTERVAL` – хранит разницу во времени.

**Применение**: даты создания записей, дедлайны, временные метки событий.

### 5. NULL – отсутствие значения

`NULL` – это специальное значение, обозначающее отсутствие данных. Оно не эквивалентно 0 или пустой строке.

**Пример:** если у пользователя нет номера телефона, его значение в столбце `phone` может быть `NULL`.

### 6. Собственные (кастомные) типы данных

PostgreSQL позволяет создавать собственные типы данных, например:

- `ENUM` – список допустимых значений (например, ('новый', 'в процессе', 'завершён') для статуса заказа).
- `JSON` и `JSONB` – хранение структурированных данных в формате JSON.

## Основные операции с данными (CRUD)

![CRUD.jpeg](image/CRUD.jpeg)

**CRUD** – это аббревиатура из четырёх основных операций, которые выполняются с данными в базе. Эти операции соответствуют основным действиям с записями в таблицах.

### C – Create (Создание)

Операция `Create` добавляет новые записи в таблицу. Например, если у нас есть таблица с пользователями, при создании нового пользователя в базу добавляется новая строка.

Пример: Представьте, что мы добавляем нового клиента в таблицу. До этого в базе были три клиента, и теперь появился четвёртый. В результате в таблице появляется новая строка с данными нового пользователя.

| id  | имя      | email               | возраст |
|-----|---------|--------------------|--------|
| 1   | Иван    | ivan@example.com   | 25     |
| 2   | Мария   | maria@example.com  | 30     |
| 3   | Алексей | alex@example.com   | 28     |
| 4   | Ольга | olga@example.com   | 22     |

### R – Read (Чтение)

Операция `Read` используется для получения информации из базы данных. Это может быть запрос всех данных из таблицы или выборка конкретных записей.

Пример: Если нам нужно найти всех пользователей старше 25 лет, мы получим следующий результат:

| id  | имя      | email               | возраст |
|-----|---------|--------------------|--------|
| 2   | Мария   | maria@example.com  | 30     |
| 3   | Алексей | alex@example.com   | 28     |

Таким образом, мы получили только нужные нам данные, не изменяя саму базу.

### U – Update (Обновление)

Операция `Update` изменяет существующие данные в базе. Например, если у пользователя изменился email, его можно обновить.

Пример: Мария поменяла свой `email`. Вместо `maria@example.com` теперь указан новый адрес `maria_new@example.com`:

| id  | имя      | email               | возраст |
|-----|---------|--------------------|--------|
| 1   | Иван    | ivan@example.com   | 25     |
| 2   | Мария   | maria_new@example.com  | 30     |
| 3   | Алексей | alex@example.com   | 28     |
| 4   | Ольга | olga@example.com   | 22     |

Таким образом, информация в базе обновилась, но сами строки остались на своих местах.

### D – Delete (Удаление)

Операция `Delete` удаляет существующие данные. Например, если Ольга удалила свой аккаунт, её запись исчезнет из таблицы.

Пример: После удаления пользователя Ольги таблица примет такой вид:

| id  | имя      | email               | возраст |
|-----|---------|--------------------|--------|
| 1   | Иван    | ivan@example.com   | 25     |
| 2   | Мария   | maria@example.com  | 30     |
| 3   | Алексей | alex@example.com   | 28     |

Теперь в базе нет информации о пользователе Ольге.

![IamCRUD.jpg](image/IamCRUD.jpg)

Таким образом, **CRUD**-операции являются основными действиями, которые можно выполнять с данными в базе.