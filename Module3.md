# MODULE 3. Интернет-магазин на Django (практический модуль)

![](https://envybox.io/blog/wp-content/uploads/2020/04/ecommerce-1.jpg)

## Введение

Каждый следующий шаг будет логическим продолжением предыдущего. Таким образом, к концу модуля вы получите готовый интернет-магазин, включающий регистрацию и логин пользователей, отображение списка товаров, корзину, оформление заказов и управление доступом.

## Что будем делать в этом модуле:

- Построим архитектуру проекта с учётом `MVT (Model-View-Template)`;
- Создадим модели: `Product`, `CartItem`, `Order`, `Category` и будем использовать `AbstractUser` для создания кастомной модели пользователя;
- Настроим шаблоны и стили для фронтенда;
- Реализуем систему аутентификации: регистрация, логин и выход пользователя;
- Добавим каталог товаров: список, детальная страница, фильтрация и пагинация;
- Настроим корзину на основе отдельной таблицы в базе данных;
- Добавим возможность оформления заказа;
- Реализуем отображение истории заказов для пользователя;
- Используем `Class-Based Views`, формы (`Form` и `ModelForm`), миксины `LoginRequiredMixin`, `UserPassesTestMixin`, `PermissionRequiredMixin`, и другие инструменты, которые изучаем в курсе.

## Блок 1: Инициализация проекта (Домашка после лекции 22)

Перед тем как начать разработку магазина, необходимо создать базовый Django-проект, подготовить структуру и настроить базу данных.

### Что нужно сделать на этом этапе:

1. **Создать новый проект Django.**

   - Создать папку `my_project` и внутри неё создать виртуальное окружение с помощью команды `python -m venv venv`.
2. **Настроить виртуальное окружение для проекта, чтобы изолировать зависимости.**

   - Активировать виртуальное окружение:
     - Windows: `venv\Scripts\activate`
     - Linux/Mac: `source venv/bin/activate`
     - Установить Django с помощью команды `pip install django`.
     - Создать проект с помощью команды `django-admin startproject my_project`.
        - Название проекта: `my_project` (или любое другое, на ваше усмотрение).
3. **Создать отдельное Django-приложение, которое будет отвечать за основной функционал магазина (У нас оно должно быть, `shop`).**

   - Внутри папки `my_project` выполнить команду `python manage.py startapp shop`.
4. **Подключить приложение к проекту, добавив его в `INSTALLED_APPS`.**

   - В `settings.py` добавить `shop` в список `INSTALLED_APPS`.
5. **Настроить маршруты (`urls.py`).После создания приложения `shop`, необходимо настроить систему маршрутизации:**

   1. **Создать файл `urls.py` внутри приложения `shop`, если он ещё не создан.**

      - В этом файле будут располагаться все локальные маршруты, относящиеся к интернет-магазину.
   2. **Подключить маршруты приложения `shop` к общему маршрутизатору проекта**

      - В `urls.py` проекта (`my_project/urls.py`) подключить маршруты из приложения shop с помощью функции `include()`.
   3. **Добавить следующие маршруты в `shop/urls.py`:**

      - `/` — главная страница магазина (`index`)
      - `/about/` — страница "О нас" (`about`)
      - `/contact/` — страница с контактами (`contact`)
      - `/products/` — список всех товаров (`product_list`)
      - `/products/<int:pk>/` — подробная информация о товаре (`product_detail`)
      - `/login/` — страница авторизации (`login_view`)
      - `/register/` — страница регистрации (`register_view`)
      - `/logout/` — выход из аккаунта (`logout_view`)
   4. **Создать соответствующие представления (views.py):**

      - `index(request)` — отображает главную страницу
      - `about(request)` — информация о компании
      - `contact(request)` — форма или контакты
      - `product_list(request)` — список товаров
      - `product_detail(request, pk)` — подробности о конкретном товаре
      - `login_view(request)` — форма входа
      - `register_view(request)` — форма регистрации
      - `logout_view(request)` — выход пользователя

      Дальше, в зависимости от лекций, мы будем добавлять новые представления и маршруты(Сейчас остановимся на этих, чтобы не перегружать проект).
6. **Убедиться, что сервер запускается, а маршруты работают корректно.**

На этом этапе мы получаем полностью рабочий каркас проекта, готовый для разработки. Далее, в зависимости от тем лекций, мы будем добавлять в проект новые возможности: шаблоны, модели, формы, авторизацию, `CBV` и многое другое.

## Блок 2: Подключение и работа с шаблонами (Домашка после лекции 23)

### Цель блока:

Научиться подключать HTML-шаблоны, работать с динамическими данными, наследованием, статикой и логическими конструкциями в шаблонах Django. Этот этап отвечает за визуальную часть интернет-магазина.

### Что нужно сделать в этом блоке:

1. **Создать глобальную папку `templates/` на уровне проекта.**

   - В ней будут располагаться шаблоны, общие для всего проекта (например, базовая структура сайта).
2. **Убедиться, что в `settings.py` проекта путь до `templates/` прописан правильно.**

   - В блоке `TEMPLATES → DIRS` добавить: `'templates'`
   - Убедиться, что `APP_DIRS = True` — это позволит Django искать шаблоны и в приложениях.
3. **Создать базовый шаблон `base.html`.**

   - Он должен содержать:
     - стандартную HTML-разметку (`<html>`, `<head>`, `<body>`)
     - блоки для наследования: `{% block title %}`, `{% block content %}`
     - подключение статики (`{% load static %}`)
     - подключение CSS-файлов и меню через `{% include %}`
4. **Создать шаблоны страниц `index.html`, `about.html`, `contact.html`, `products.html`, `product_detail.html`, `login.html`, `register.html`.**

   - Все шаблоны должны наследоваться от `base.html` с помощью `{% extends "base.html" %}`.
   - В каждом шаблоне реализовать соответствующий блок контента.
   - В шаблонах `products.html` и `product_detail.html` предусмотреть вывод динамического списка товаров и деталей товара (на этом этапе можно пока заглушками).
5. **Настроить работу со статическими файлами:**

   - Создать папку `static/shop/`
   - Внутри — папки `css`, `js`, `img`
   - Добавить файл стилей `style.css` и подключить его в `base.html`
6. **Реализовать меню через `{% include %}` и вставить его в `base.html`:**

   - В `templates/includes/menu.html` разместить навигацию (например, Главная, О нас, Контакты, Каталог, Вход, Регистрация, Корзина).ТУт на ваше усмотрение, можно добавить ссылки на страницы, которые мы создали в `urls.py`.
   - Подключить меню в `base.html` с помощью `{% include "includes/menu.html" %}`.
7. `В представлениях (`views.py `приложения`shop `) передавать контекст в шаблоны.`

   - Например:
     - список товаров в `products.html`
     - имя пользователя в `index.html`
     - и т.д.(Тут можно передавать любые данные, которые вам нужны для отображения на странице).
   - Для передачи контекста использовать `render(request, 'template.html', context)`.
8. **В шаблонах использовать конструкции шаблонного языка Django:**

   - Вывод переменных: `{{ variable }}`
   - Циклы: `{% for ... %}{% endfor %}`
   - Условия: `{% if ... %}{% endif %}`
   - `forloop.counter`, `empty` и фильтры: `{{ value|upper }}`, `{{ list|length }}`, `{{ date|date:"d.m.Y" }}` и т.д. Использовать фильтры для форматирования данных по вашему усмотрению.
9. **Настроить ссылки между страницами с помощью тега `{% url %}`**

   - Пример: `<a href="{% url 'products' %}">`Каталог `</a>`
10. **По желанию: реализовать адаптивность через CSS или несколько базовых шаблонов (например, отдельный для корзины, личного кабинета, оформления заказа).**

    - Это не обязательно, но будет полезно для понимания работы с шаблонами и адаптивностью.

## Блок 3: Настройка базы данных PostgreSQL и создание моделей (Домашка после лекции 24)

### Цель блока:

Настроить подключение к базе данных `PostgreSQL`, создать основные модели интернет-магазина и продумать их связи. Также применим возможности `class Meta`, абстрактных и прокси-моделей для организации логики и переиспользования кода.

### Что нужно сделать:

1. Настроить PostgreSQL как основную базу данных:

   - Установить `PostgreSQL`, если он ещё не установлен.
   - Создать базу данных и пользователя через `psql`.
   - Обновить настройки в `settings.py`:
   - Установить библиотеку `psycopg2` с помощью команды `pip install psycopg2`. Проверьте, что она установлена в вашем виртуальном окружении.

     ```python
     DATABASES = {
         'default': {
             'ENGINE': 'django.db.backends.postgresql',
             'NAME': 'your_db_name', # имя вашей базы данных
             'USER': 'your_user', # имя пользователя
             'PASSWORD': 'your_password', # пароль пользователя
             'HOST': 'localhost',
             'PORT': '5432',
         }
     }
     ```

**2. Создать кастомную модель пользователя**

> ⚠️ Это важно сделать до первой миграции!

В `models.py` создайте новую модель `User`, унаследовавшись от `AbstractUser`. Добавьте поле `balance (DecimalField)` для хранения баланса пользователя. Это поле будет использоваться для хранения средств, доступных пользователю для покупок в интернет-магазине. Предлагаю использовать `DecimalField` с двумя знаками после запятой. При создании поля `balance` укажите значение по умолчанию `10000.00`.

В `settings.py` пропишите:

```python
AUTH_USER_MODEL = 'shop.User'
```

3. **Определить ключевые сущности проекта**
   В рамках интернет-магазина нам понадобятся следующие модели:

   1. **`(Category)` - Категория товаров**

      - Название категории.
      - Дата создания.
      - Дата последнего обновления.
   2. **`(Product)` - Товар**

      - Название товара.
      - Описание.
      - Цена.
      - Изображение (опционально). Тут можно использовать `ImageField`.
      - Дата создания и обновления.
      - Категория (связь `One-to-Many` с `Category`).
   3. **`(Cart)` - Корзина**

      - Привязка к пользователю. (Тут можно использовать встроенную модель `User`. Связь `One-to-One`).
      - Дата создания и обновления.
   4. **`(CartItem)` - Элемент корзины**

      - Ссылка на корзину. Тип связи `ForeignKey`( One-to-Many).
      - Ссылка на товар. Тип связи `ForeignKey`( One-to-Many).
      - Количество.
      - Дата создания и обновления.
   5. **`(Order)` - Заказ**

      - Привязка к пользователю. Тип связи `ForeignKey`( One-to-Many).
      - Дата создания и обновления.
      - Общая сумма заказа.
   6. **`(OrderItem)` - Элемент заказа**

      - Ссылка на заказ. Тип связи `ForeignKey`( One-to-Many).
      - Ссылка на товар. Тип связи `ForeignKey`( One-to-Many).
      - Количество.
      - Цена на момент покупки.
      - Дата создания и обновления.
   7. **`Purchase` — Покупка (дополнительная модель)**

      - Ссылка на `OrderItem` (через `OneToOneField`)
      - Сумма оплаты (`price * quantity`)
      - Дата оплаты (`paid_at`)

      Используется для фиксации факта оплаты. Может быть полезна при ведении бухгалтерии, возвратов или финансовой отчётности. Не дублирует данные, а лишь фиксирует, что заказ был успешно оплачен.
4. **Построить связи между моделями**
   Самостоятельно реализуйте связи между моделями:

   - Один товар принадлежит одной категории — `One-to-Many`.
   - Один заказ или корзина содержит много товаров, и каждый товар может быть в разных корзинах или заказах — `Many-to-Many` через промежуточные модели (`CartItem`, `OrderItem`).
   - `Cart` и `Order` связаны с пользователем (один пользователь может иметь несколько заказов и одну корзину).
   - `CartItem` и `OrderItem` связаны с `Cart` и `Order` соответственно (один элемент может принадлежать только одной корзине или заказу, но один заказ или корзина могут содержать много элементов).
   - `Purchase` связан с `OrderItem` через `OneToOneField`.
5. **Добавить поля времени**
   Каждая модель должна содержать два системных поля:

   - `created_at` — дата создания объекта.
   - `updated_at` — дата последнего обновления.

   Эти поля нужны для удобства администрирования, логирования и отображения информации пользователю.
6. **Провести миграции**
   После определения всех моделей:

   - создай миграции с помощью `makemigrations`;
   - примени их с помощью `migrate`;
   - убедиcь, что структура БД успешно сформировалась.
7. **Создать админку для моделей**

   - Создать супер_юзера с помощью команды `python manage.py createsuperuser`.
   - В `admin.py` приложения `shop` зарегистрируй все модели, чтобы они отображались в админке.
   - Настройте отображение полей, фильтры и поиск по ним.
   - Убедитесь, что все модели отображаются корректно и можно добавлять/редактировать данные.
   - Проверьте, что в админке можно добавлять товары, категории и заказы.
   - Добавьте несколько тестовых товаров и категорий, чтобы проверить работу админки.

## Блок 4: Работа с Django ORM на практике(Домашка после лекции 25)

### Цель блока:

Закрепить знания, полученные на лекции по работе с Django ORM, и научиться создавать, получать, фильтровать, обновлять и удалять данные с использованием реальных моделей интернет-магазина, реализованных в предыдущем задании.

### Что необходимо сделать:

**1. Подготовка среды**
    - Убедитесь, что все модели из предыдущего блока реализованы и применены через`makemigrations` и `migrate`.
    - Запустите Django `shell` командой:
        ```sh
        python manage.py shell
        ```

    В этом режиме вы будете выполнять все задания.

**2. Создание данных (C — Create)**
Создайте объекты для следующих моделей:
    - Категории: не менее 2 различных категорий.
    - Товары: по 2–3 товара на каждую категорию.
    - Корзину для тестового пользователя.
    - Элементы корзины: добавьте несколько товаров в корзину.
    - Заказ с несколькими товарами через модель `OrderItem`.

Подсказка: используйте как `Model.objects.create(...)`, так и поэтапное создание через `.save()`.

**3. Получение данных (R — Retrieve)**
Выполните запросы с использованием `all()`, `get()`, `filter()`, `exclude()`, `values()`, `values_list()` и т.д.
    - Получите все товары.
    - Найдите товар по `ID`.
    - Получите все товары, которые стоят меньше `1000`.
    - Получите все категории товаров.
    - Найдите категорию по названию.
    - Получите все товары из определённой категории.
    - Найдите все товары, у которых цена выше заданного значения.
    - Получите все заказы пользователя.
    - Найдите заказ с конкретным товаром.
    - Получите все товары из корзины определённого пользователя.:

**4. Фильтрация с условиями**
Примените следующие операторы:
    - `__gt`, `__lt`, `__icontains`, `__in`, `__range`, `__isnull`.
    - Постройте несколько сложных фильтров с использованием `Q()`:
        - Найдите товары, которые стоят от 500 до 1500.
        - Найдите товары, которые стоят меньше 1000 и название которых начинается с *«A»*.
        - Найдите товары, которые стоят больше 1000 или название которых содержит «про».
        - Найдите пользователей, у которых нет ни одного заказа.

**5. Обновление данных (U — Update)**
Измените:
    - Название одного из товаров.
    - Цену нескольких товаров сразу (через `update()`).
    - Количество товара в корзине.
    - Используйте `F()` для увеличения цены на 10%.

**6. Удаление данных (D — Delete)**
Удалите:
    - Один товар по ID.
    - Все элементы корзины у пользователя.
    - Все заказы, созданные до определённой даты.

**7. Агрегация и аннотация**
    - Посчитайте общее количество товаров.
    - Найдите сумму всех заказов пользователя.
    - Определите среднюю цену товаров.
    - Для каждой категории посчитайте количество товаров через `annotate(...)`.

**8. Оптимизация запросов**
    - Получите список всех товаров и их категорий с использованием select_related.
    - Получите список всех категорий и связанные товары через prefetch_related.

**9. Транзакции**
Реализуйте функцию создания заказа в блоке `transaction.atomic()`, которая:
    - Создаёт заказ и несколько связанных `OrderItem`.
    - Прерывает выполнение (например, выбрасывает исключение).
    - Проверьте, что данные не записались в случае ошибки.

**Если всё сделано корректно, Вы получите глубокое понимание того, как работает Django ORM на практике, и сможете уверенно применять её в реальных проектах.**

## Блок 5: Формы, ModelForm, User, Аутентификация (Домашка к лекции 26)

### Цель блока:

Научиться работать с `HTML-формами`, `Django-формами`, `ModelForm`, а также реализовать регистрацию, вход в систему и авторизацию пользователей на практике. Все задания основаны на проекте интернет-магазина и моделях: `Product`, `Category`, `Cart`, `Order` и т.д.

### Что нужно сделать:

**1. Создание HTML-формы и работа с `GET` и `POST`**
Создайте простую HTML-страницу с формой, которая позволяет фильтровать товары по ключевому слову (названию). Реализуйте приём и обработку формы в представлении:
    - если метод `GET` — отобразите список всех товаров или отфильтрованных по ключевому слову;
    - если метод `POST` — верните результат в виде *“Вы искали: <название>”*.
    **Подсказка**: используйте `request.GET.get('search')` или `request.POST.get('search')`. Создайте отдельный шаблон для формы и отображения результатов. Например, `search_product.html`.Этот шаблон нужен учебных целях, чтобы понять, как работает `GET` и `POST` в Django.
    
**2. Реализация Django-формы для добавления товара**
Создайте `forms.py` и реализуй класс `ProductForm` на основе `forms.Form`. Поля:
    - `name (CharField)`,
    - `price (DecimalField)`,
    - `category (ChoiceField)` — вручную подтяните категории из модели.**

Реализуйте в `views.py` представление:
    - отображение формы при `GET`;
    - создание товара при `POST`.

**Важно:** товары пока не сохраняем в базу — просто проверь, что форма работает и проходит валидацию.

**3. Перепишите форму на `ModelForm`**
Создайте `ProductModelForm` на основе модели `Product`. Используй `Meta` и настройте поля, виджеты и валидацию:
    - поля: `name`, `price`, `category`;
    - добавьте `clean_price`, который запрещает цену ниже 1;
    - добавьте кастомное сообщение об ошибке, если в названии содержится запрещённое слово (например, `"запрещено"`).

Отобразите форму в шаблоне. При успешной отправке — сохраняйте товар в базу.

**4. Реализация формы редактирования товара**
Создайте представление, которое:
    - получает объект `Product` по `pk`;
    - отображает заполненную форму (`ModelForm`);
    - сохраняет изменения при отправке формы.

Убедитесь, что при `GET` форма уже заполнена, а при `POST` — данные обновляются.

**5. Регистрация пользователя (с использованием UserCreationForm)**
В `register_view` (создайте, если не создали), где пользователь может зарегистрироваться. Используй встроенную форму `UserCreationForm`. Не забываем, что у нас кастомная модель пользователя.
    - создайте шаблон `register.html` с выводом ошибок.
    - при успешной регистрации — залогиньте пользователя и перенаправьте на главную страницу.
    - при ошибках — отобразите их в шаблоне.

**6. Реализация логина и логаута**
Добавьте форму `LoginForm` (через `forms.Form`), где пользователь вводит логин и пароль. Во `login_view(request)` используйте `authenticate()` и `login()`.
    - добавьте шаблон `login.html`.
    - при успехе — сохраняйте пользователя в сессию;
    - при ошибке — отобразите сообщение об ошибке в шаблоне.

Добавьте кнопку *“Выйти”* на главной, реализуйте `logout_view()` с `logout()`.

**7. Отображение корзины и удаление позиций**
Создайте шаблон `cart.html`, в котором:
    - отображаются все `CartItem` текущего пользователя;
    - у каждого товара — кнопка «Удалить» (реализуй отдельный `view` и `url` для удаления элемента);
    - на главной — кнопка «Перейти в корзину», ведущая на `/cart/`.

**8. Привязка корзины к пользователю**
Проверте модель `Cart`, чтобы она была привязана к `User` через `OneToOneField` (одна корзина на пользователя).
    - реализуйте `@login_required`, чтобы доступ к корзине был только у авторизованного пользователя;
    - при заходе на `/cart/` проверьте — если корзины нет, создай её. Это можно сделать в `views.py`. с помощью `get_or_create()`.
    - добавьте кнопку *“Перейти в корзину”* на главной странице, которая ведёт на `/cart/`.

**9. Добавление товара в корзину через форму**
Создайте форму `AddToCartForm`:
    - поле `quantity` (целое число от 1 до 10);
    - поле `product` (скрытое, задаётся в представлении).

Реализуйте `add_to_cart_view(request, pk)`:
    - получите товар по `pk`;
    - получите корзину пользователя;
    - добавьте `CartItem` с нужным товаром и количеством;
    - если товар уже в корзине — увеличьте количество.
    - если количество больше 10 — верните ошибку.
    - при успешном добавлении — перенаправьте на `/cart/`.
    - при ошибке — отобразите её в шаблоне.

**10. Оформление заказа (покупка товаров из корзины)**
Добавьте возможность оформления заказа из корзины текущего пользователя.
Что нужно реализовать:

- Представление `checkout_view(request)`:

  - должно быть защищено через `@login_required`;
  - при `GET` — отобразите кнопку "Оформить заказ", список товаров из корзины и итоговую сумму;
  - при `POST`:

    - создайте объект `Order`;
    - скопируйте все `CartItem` в `OrderItem` (сохранив количество и цену на момент покупки);
    - проверьте, что у пользователя достаточно средств на счёте;
    - если средств недостаточно — верните ошибку;
    - удалите `CartItem` из корзины;
    - очистите корзину (удалите все `CartItem`);
    - очистите корзину (удалите все CartItem);
    - перенаправьте на страницу с подтверждением.
- Шаблон `checkout.html`:

  - отображение списка товаров и общей суммы;
  - форма с кнопкой *"Подтвердить заказ"*.
- Убедитесь, что:

  - если корзина пуста — перенаправляйте пользователя обратно;
  - данные корректно копируются из корзины в заказ;
  - после оформления заказ отображается в админке.

**11. Просмотр заказов пользователя**
    Реализуйте страницу `my_orders/`, на которой отображаются все заказы текущего пользователя:
    - используйте `@login_required`;
    - в представлении получите все заказы пользователя;
    - в шаблоне отобразите:
      - номер заказа,
      - дату создания,
      - список товаров с количеством и ценой.
    - Можно использовать шаблон `my_orders.html`.
    - Добавьте ссылку на страницу в меню.
    - Убедитесь, что только авторизованный пользователь видит свои заказы.

## Блок 6: Переписываем проект на CBV (Class-Based Views) (Домашка к лекции 27)

### Цель блока:
Закрепить навыки работы с представлениями на основе классов в Django. Полностью переписать проект интернет-магазина на CBV: от главной страницы и списка товаров до форм добавления, редактирования и удаления, а также работы с корзиной и заказами.

### Общая идея:

Мы уже реализовали основной функционал с использованием `FBV`. Теперь задача — переписать представления на `CBV` постепенно, от самого простого (`View`, `TemplateView`) до сложного (`FormView`, `CreateView`, `UpdateView`, `DeleteView`, `LoginView`, `LogoutView`).

Всё — на базе моделей `Product`, `Category`, `Cart`, `Order`, `OrderItem`, `Purchase` и кастомной модели пользователя с балансом.

### Что нужно сделать:

**1. Главная страница (TemplateView)**
Перепишите представление главной страницы на основе `TemplateView`.
В шаблоне должна быть:

    - Кнопка перехода к товарам;
    - Кнопка «Перейти в корзину» (если пользователь авторизован);
    - Приветствие пользователя.
    - Навигация по страницам (о нас, контакты и т.д.).

**2. Страница «О нас» и «Контакты» (TemplateView)**
Перепишите представления для страниц «О нас» и «Контакты» на основе `TemplateView`. Также найдите все статические шаблоны м перепишите их на основе `TemplateView`.
    - Используйте `template_name` для указания шаблона.
    - Добавьте контекст с данными (например, имя компании, адрес и т.д.).
    - Убедитесь, что страницы отображаются корректно.

**3. Список товаров (ListView)**
Используйте `ListView`, чтобы отобразить все товары. Добавь пагинацию `(paginate_by = 5)` и возможность фильтрации через `GET` (например, `?search=чай`).
    - `ProductListView(ListView)`
    - `product_list.html`
    - В `get_queryset()` реализуй фильтрацию по `name__icontains`.
    - Не забудьте сделать слайдер для пагинации.(Читать лекцию 27 по пагинации)
    - По желанию добавьте сортировку по цене и названию. С помощью `order_by()`.

**4. Детальная страница товара (DetailView)**
Вывод информации о товаре с возможностью добавить в корзину.
    - `ProductDetailView(DetailView)`
    - `product_detail.html`

Добавь в шаблон:
    - Название, описание, цена, изображение товара(если есть);
    - Кнопку «Добавить в корзину» (форма). Тут нужно проверять на авторизацию пользователя;

**5. Добавление товара (CreateView)**
Создайте `ProductCreateView(CreateView)` с использованием `ModelForm` или `fields = [...]`. Добавьте валидацию цены, переопредели `form_valid()`. Доступ к этой странице только для администраторов. Не забудь добавить ссылку на страницу в меню только для администраторов.
    - `ProductCreateView(CreateView)`
    - `product_form.html`

**6. Редактирование товара (UpdateView)**
Используйте `ProductUpdateView(UpdateView)` — форма с уже заполненными данными. Добавьте проверку, что пользователь — администратор. Переопределите `form_valid()` для обработки ошибок. Не забудьте добавить ссылку на страницу в меню только для администраторов.
    - `ProductUpdateView(UpdateView)`
    - `product_update.html`
    
**7. Удаление товара (DeleteView)**

Удаление товара через `ProductDeleteView(DeleteView)` с подтверждением. Добавьте проверку, что пользователь — администратор. 
Переопределите `form_valid()` для обработки ошибок. Не забудьте добавить ссылку на страницу в меню только для администраторов.
    - `ProductDeleteView(DeleteView)`
    - `product_confirm_delete.html`
    - Добавьте ссылку на страницу в меню только для администраторов.

**8. Корзина (ListView + логика в get/get_queryset)**
Создайте `CartView(LoginRequiredMixin, View)` или `ListView`, который:
    - отображает все `CartItem` пользователя;
    - автоматически создаёт корзину `Cart` через `get_or_create()`.
    - добавьте возможность удаления товара из корзины через `DeleteView` или `FormView`;
    - добавьте возможность изменения количества товара в корзине через `FormView` или `UpdateView`.
    - добавьте возможность очистки корзины через `DeleteView` или `FormView`.
    - добавьте возможность оформления заказа через `CheckoutView` (на основе `FormView` или `CreateView`):
        - создаёт объект `Order`, `OrderItem`;
        - списывает деньги с `User.balance`;
        - очищает корзину;
        - создаёт `Purchase`-записи.
        - добавьте возможность просмотра всех заказов пользователя через `MyOrdersView` (на основе `ListView`)

**9. Аутентификация и регистрация**
Регистрация — `UserCreateView(CreateView)` с `UserCreationForm`.
    - Вход — `LoginView`;
    - Выход — `LogoutView`.
    - Регистрация - `UserRegisterView(CreateView)` с `UserCreationForm`.

**10. Управление доступом через миксины**
Добавьте `LoginRequiredMixin` ко всем представлениям, где нужен логин. Для `UpdateView`, `DeleteView`. Для операций добавить, удалить, редактировать товары — добавьте `UserPassesTestMixin` для проверки прав администратора.

> Не забывайте про шаблоны! Там всё должно работать — как раньше, просто за счёт классов.

Если всё сделано корректно, вы получите глубокое понимание того, как работают представления на основе классов в Django и сможете уверенно применять их в реальных проектах. Желаю ужачи в выполнении заданий!